#!/bin/bash
set -euxo pipefail
export N=$((1<<16))

(
  cd sorting/program
  cargo prove build
)
(
  cd sorting/script

  export RUSTFLAGS="-C target-cpu=native -C target-feature=+avx512f"
  # export RUSTFLAGS="-C target-cpu=native"
  export RUST_LOG=info
  # cargo clean
  cargo build --release --bin sorting
  /usr/bin/time --verbose -- cargo run --release -- --n=$N --prove
  echo "RUSTFLAGS=\'${RUSTFLAGS:-}\'"
  echo "N=\'${N}'"
)
